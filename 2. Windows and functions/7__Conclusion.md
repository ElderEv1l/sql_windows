# Резюме

Вот задачи, которые решаются с помощью оконных функций в SQL:

  * Ранжирование (всевозможные рейтинги).1
  * Сравнение со смещением (соседние элементы и границы).2
  * Агрегация (количество, сумма и среднее).3
  * Скользящие агрегаты (сумма и среднее в динамике).4
  * Статистика (относительные ранги и сводные показатели).5

  
Оконные функции вычисляют результат по строкам, которые попали в окно. Определение окна указывает, как выглядит окно:

Из каких секций состоит (partition by).
Как отсортированы строки внутри секции (order by).
Как выглядит фрейм внутри секции (rows between).
window w as (
  partition by ...
  order by ...
  rows between ... and ...
)
partition by поддерживается всеми оконными функциями и всегда необязательно. Если не указать — будет одна секция.

order by поддерживается всеми оконными функциями (кроме процентилей). Для функций ранжирования и смещения оно обязательно, для агрегации — нет. Если не указать order by для функции агрегации — она посчитает обычный агрегат, если указать — скользящий.

Фрейм поддерживается только некоторыми функциями:

first_value(), last_value(), nth_value();
функции агрегации.
Остальные функции фреймы не поддерживают.
